<div class="panel panel-default" ng-controller="TrackCtrl">
  <div class="panel-body">
    <form class="form-inline" name="queryParamForm">
      <div class="alert alert-warning" role="alert" ng-show="queryParamForm.$invalid && queryParamForm.submitted">
        <ul>
          <ol ng-show="queryParamForm.assignedSince.$invalid">客户分配时间（起）格式不对，正确格式：YYYY-MM-DD</ol>
          <ol ng-show="queryParamForm.assignedUpTo.$invalid">客户分配时间（讫）格式不对，正确格式：YYYY-MM-DD</ol>
          <ol ng-show="queryParamForm.registeredSince.$invalid">客户注册时间（起）格式不对，正确格式：YYYY-MM-DD</ol>
          <ol ng-show="queryParamForm.registeredUpTo.$invalid">客户注册时间（讫）格式不对，正确格式：YYYY-MM-DD</ol>
          <ol ng-show="queryParamForm.assetsAcquired.$error.number">投资次数必须是一个整数值</ol>
          <ol ng-show="queryParamForm.assetsValue.$error.number">投资金额必须是一个数值</ol>
          <ol ng-show="queryParamForm.assetsMaturingSince.$invalid">资产到期日期（起）格式不对，正确格式：YYYY-MM-DD</ol>
          <ol ng-show="queryParamForm.assetsMaturingUpTo.$invalid">资产到期日期（讫）格式不对，正确格式：YYYY-MM-DD</ol>
        </ul>
      </div>
      <div class="form-group">
        <label class="sr-only" for="assignedSince">客户分配时间（起）</label>
        <div class="input-group datepicker">
          <input type="text" class="form-control" id="assignedSince" name="assignedSince" placeholder="请输入客户分配时间（起）" ng-model="queryParam.assignedSince" datepicker-popup="yyyy-MM-dd" is-open="assignedSinceOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();assignedSinceOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label class="sr-only" for="assignedUpTo">客户分配时间（讫）</label>
        <div class="input-group datepicker">
          <input type="text" class="form-control" id="assignedUpTo" name="assignedUpTo" placeholder="请输入客户分配时间（讫）" ng-model="queryParam.assignedUpTo" datepicker-popup="yyyy-MM-dd" is-open="assignedUpToOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();endDateOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label class="sr-only" for="registeredSince">客户注册时间（起）</label>
        <div class="input-group datepicker">
          <input type="text" class="form-control" id="registeredSince" name="registeredSince" placeholder="请输入客户注册时间（起）" ng-model="queryParam.registeredSince" datepicker-popup="yyyy-MM-dd" is-open="registeredSinceOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();registeredSinceOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label class="sr-only" for="registeredUpTo">客户注册时间（讫）</label>
        <div class="input-group datepicker">
          <input type="text" class="form-control" id="registeredUpTo" name="registeredUpTo" placeholder="请输入客户注册时间（讫）" ng-model="queryParam.registeredUpTo" datepicker-popup="yyyy-MM-dd" is-open="registeredUpToOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();registeredUpToOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label class="sr-only" for="userName">销售代表名称</label>
        <input type="text" class="form-control" id="userName" name="userName" placeholder="请输入销售代表名称" ng-model="queryParam.userName">
      </div>
      <div class="form-group">
        <label class="sr-only" for="memberStatus">客户状态</label>
        <select class="form-control" id="memberStatus" ng-init="queryParam.memberStatus=''" ng-model="queryParam.memberStatus">
          <option value="">--全部客户状态--</option>
          <option ng-repeat="status in enums.memberStatus" value="{{status.value}}">{{status.name}}</option>
        </select>
      </div>
      <div class="form-group">
        <label class="sr-only" for="possibility">成功几率</label>
        <select class="form-control" id="possibility" ng-init="queryParam.possibility=''" ng-model="queryParam.possibility">
          <option value="">--全部成功几率--</option>
          <option ng-repeat="poss in enums.possibility" value="{{poss.value}}">{{poss.name}}</option>
        </select>
      </div>
      <div class="form-group">
        <label class="sr-only" for="assetsAcquired">投资次数</label>
        <input type="number" class="form-control" id="assetsAcquired" name="assetsAcquired" placeholder="请输入投资次数" ng-model="queryParam.assetsAcquired">
      </div>
      <div class="form-group">
        <label class="sr-only" for="assetsValue">投资金额</label>
        <input type="number" class="form-control" id="assetsValue" name="assetsValue" placeholder="请输入投资金额" ng-model="queryParam.assetsValue">
      </div>
      <div class="form-group">
        <label class="sr-only" for="assetsMaturingSince">资产到期日期（起）</label>
        <div class="input-group">
          <input type="text" class="form-control" id="assetsMaturingSince" name="assetsMaturingSince" placeholder="请输入资产到期日期（起）" ng-model="queryParam.assetsMaturingSince" datepicker-mode="'month'" datepicker-popup="yyyy-MM" is-open="assetsMaturingSinceOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();assetsMaturingSinceOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label class="sr-only" for="assetsMaturingUpTo">资产到期日期（讫）</label>
        <div class="input-group">
          <input type="text" class="form-control" id="assetsMaturingUpTo" name="assetsMaturingUpTo" placeholder="请输入资产到期日期（起）" ng-model="queryParam.assetsMaturingUpTo" datepicker-mode="'month'" datepicker-popup="yyyy-MM" is-open="assetsMaturingUpToOpened" datepicker-options="{startingDay: 1}" close-text="关闭" current-text="今天" clear-text="清空">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$event.preventDefault();$event.stopPropagation();assetsMaturingUpToOpened = true"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </div>
      </div>
      <button type="button" class="btn btn-primary" ng-click="find()">查询</button>
      <button type="button" class="btn btn-default" ng-click="findYesterday()">查询昨天</button>
      <button type="button" class="btn btn-default" ng-click="findToday()">查询今天</button>
      <div class="form-group">
        <label for="pageSize">每页显示</label>
        <select class="form-control" id="pageSize" ng-init="queryParam.pageSize = 10" ng-model="queryParam.pageSize" ng-change="find()">
          <option value="10">10行</option>
          <option value="20">20行</option>
          <option value="30">30行</option>
          <option value="40">40行</option>
          <option value="50">50行</option>
        </select>
      </div>
    </form>
  </div>
  <div tabset>
    <div heading="新分配客户" select="newAlloPageChanged(); tabs.activeTab=0" tab>
      <div ng-if="newAlloList.totalItems>0">
        <table class="table table-striped table-hover table-bordered">
          <tr>
            <th>销售专员</th>
            <th>注册时间</th>
            <th>客户名称</th>
            <th>手机</th>
            <th>邮箱</th>
            <th>客户状态</th>
            <th>投资次数</th>
            <th>到期日期</th>
            <th>入金总额</th>
            <th>出金总额</th>
            <th>资金余额</th>
            <th>下次跟进时间</th>
            <th>成交几率</th>
            <th>备注</th>
            <th>操作</th>
          </tr>
          <tr ng-repeat="newAllo in newAlloList.data">
            <td ng-bind="newAllo.userName"></td>
            <td ng-bind="newAllo.registrationDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="newAllo.memberName"></td>
            <td ng-bind="newAllo.mobile"></td>
            <td ng-bind="newAllo.email"></td>
            <td ng-bind="newAllo.memberStatus.label"></td>
            <td ng-bind="newAllo.assetsAcquired"></td>
            <td ng-bind="newAllo.assetsMaturingDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="newAllo.deposits/100|number:2"></td>
            <td ng-bind="newAllo.withdrawals/100|number:2"></td>
            <td ng-bind="newAllo.balance/100|number:2"></td>
            <td ng-bind="newAllo.followUpDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="newAllo.possibility+'%'"></td>
            <td ng-bind="newAllo.notes"></td>
            <td style="text-align:center">
              <button class="btn btn-link" ng-click="openEditMemo(newAllo, 'lg')">修改</button>
            </td>
          </tr>
        </table>
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <p style="margin: -5px 0px 10px">共{{newAlloList.totalItems}}行</p>
            </div>
            <div class="col-md-6" style="text-align: right">
              <div pagination total-items="newAlloList.totalItems" items-per-page="newAlloList.pageSize" ng-model="newAlloList.currPageNo" ng-change="newAlloPageChanged()" max-size="5" num-pages="numPages" previous-text="&lsaquo;" next-text="&rsaquo;"></div>
            </div>
          </div>
        </div>
      </div>
      <div ng-if="newAlloList.totalItems<=0">
        <p class="text-center">没有找到任何结果！</p>
      </div>
    </div>
    <div heading="需要跟进的" select="needTrackPageChanged(); tabs.activeTab=1" tab>
      <div ng-if="needTrackList.totalItems>0">
        <table class="table table-striped table-hover table-bordered">
          <tr>
            <th>销售专员</th>
            <th>注册时间</th>
            <th>客户名称</th>
            <th>手机</th>
            <th>邮箱</th>
            <th>客户状态</th>
            <th>已投资次数</th>
            <th>到期日期</th>
            <th>入金总额</th>
            <th>出金总额</th>
            <th>资金余额</th>
            <th>下次跟进时间</th>
            <th>成交几率</th>
            <th>备注</th>
            <th>操作</th>
          </tr>
          <tr ng-repeat="needTrack in needTrackList.data">
            <td ng-bind="needTrack.userName"></td>
            <td ng-bind="needTrack.registrationDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="needTrack.memberName"></td>
            <td ng-bind="needTrack.mobile"></td>
            <td ng-bind="needTrack.email"></td>
            <td ng-bind="needTrack.memberStatus.label"></td>
            <td ng-bind="needTrack.assetsAcquired"></td>
            <td ng-bind="needTrack.assetsMaturingDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="needTrack.deposits/100|number:2"></td>
            <td ng-bind="needTrack.withdrawals/100|number:2"></td>
            <td ng-bind="needTrack.balance/100|number:2"></td>
            <td ng-bind="needTrack.followUpDate|date:'yyyy-MM-dd'"></td>
            <td ng-bind="needTrack.possibility+'%'"></td>
            <td ng-bind="needTrack.notes"></td>
            <td style="text-align:center">
              <button class="btn btn-link" ng-click="openEditMemo(needTrack, 'lg')">修改</button>
            </td>
          </tr>
        </table>
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <p style="margin: -5px 0px 10px">共{{needTrackList.totalItems}}行</p>
            </div>
            <div class="col-md-6" style="text-align: right">
              <div pagination total-items="needTrackList.totalItems" items-per-page="needTrackList.pageSize" ng-model="needTrackList.currPageNo" ng-change="pageChanged()" max-size="5" num-pages="numPages" previous-text="&lsaquo;" next-text="&rsaquo;"></div>
            </div>
          </div>
        </div>
      </div>
      <div ng-if="needTrackList.totalItems<=0">
        <p class="text-center">没有找到任何结果！</p>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="editMemo.html">
  <div class="modal-header">
    <h3 class="modal-title">修改备注</h3>
  </div>
  <div class="modal-body">
    <form name="editMemoForm" novalidate>
      <div class="form-group">
        <label for="memo">备注</label>
        <textarea class="form-control" id="memo" name="memo" rows="5" placeholder="请输入备注内容" ng-model="item.memo" ng-maxlength="300" ng-blur="editMemoForm.memo.focused=false" ng-focus="editMemoForm.memo.focused=true"></textarea>
        <p ng-show="(editMemoForm.memo.$dirty || editMemoForm.submitted) && editMemoForm.memo.$error && !editMemoForm.memo.focused">
          <small ng-show="editMemoForm.memo.$error.maxlength">备注不能超过300个字符。</small>
        </p>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" ng-click="ok()">确定</button>
    <button class="btn btn-warning" ng-click="cancel()">取消</button>
  </div>
</script>